
#!/bin/bash

# Путь к твоему приватному ключу
KEY_PATH="$HOME/.ssh/id_rsa_github"
GITHUB_USER="YBronst"

echo "=== Настройка SSH для GitHub ($GITHUB_USER) на macOS Sonoma/Sequoia ==="

# 1. Запуск ssh-agent
echo "Запускаем ssh-agent..."
eval "$(ssh-agent -s)"

# 2. Добавление ключа в агент и Keychain
if ssh-add -l | grep -q "$(basename $KEY_PATH)"; then
    echo "Ключ уже добавлен в ssh-agent"
else
    echo "Добавляем ключ в ssh-agent и Keychain..."
    ssh-add -K "$KEY_PATH"
fi

# 3. Настройка ~/.ssh/config
CONFIG_FILE="$HOME/.ssh/config"
if [ ! -f "$CONFIG_FILE" ]; then
    echo "Создаём новый файл $CONFIG_FILE"
    touch "$CONFIG_FILE"
fi

# Проверка, есть ли уже Host github.com
if grep -q "Host github.com" "$CONFIG_FILE"; then
    echo "Конфигурация для github.com уже существует, пропускаем"
else
    echo "Добавляем конфигурацию для github.com"
    cat <<EOL >> "$CONFIG_FILE"

Host github.com
  HostName github.com
  User git
  IdentityFile $KEY_PATH
  UseKeychain yes
  AddKeysToAgent yes
EOL
fi

# 4. Проверка соединения с GitHub
echo "Проверяем SSH-соединение с GitHub..."
ssh -T git@github.com

echo "=== Настройка завершена ==="
